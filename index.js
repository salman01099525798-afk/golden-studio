


const translations = {
  en: {
    meta_title: "Golden Studio - Marketing & Advertising",
    meta_description: "Golden Studio for advertising, specializing in digital marketing, video production, photography, branding, and design.",
    nav_logo: "Golden Studio",
    nav_home: "Home",
    nav_services: "Services",
    nav_portfolio: "Our Work",
    nav_contact: "Contact",
    hero_title: "Golden Studio for Marketing & Advertising",
    hero_subtitle: "We create innovative advertising solutions to grow your business.",
    hero_cta: "Get Started",
    about_title: "About Us",
    about_text: "We are a passionate team of creators, strategists, and innovators dedicated to elevating brands. Our mission is to combine artistic vision with marketing expertise to deliver results that matter and stories that resonate.",
    expertise_title: "Our Expertise",
    expertise_subtitle: "From creative concepts to flawless execution, see what we do and how we've helped others succeed.",
    services_title: "Our Services",
    services_tab_creative: "Creative & Branding",
    services_tab_marketing: "Digital Marketing",
    services_tab_tech: "Specialized Solutions",
    service_1_title: "Content & Production",
    service_1_desc: "Stunning video & photo production, from concept to final edit, to capture your brand's essence.",
    service_2_title: "Branding & Identity",
    service_2_desc: "Crafting memorable logos and a complete visual identity that makes your brand stand out.",
    service_3_title: "Visual & Graphic Design",
    service_3_desc: "Engaging social media graphics and striking visual designs that demand attention.",
    service_4_title: "Digital Presence",
    service_4_desc: "Comprehensive social media management and Google Maps optimization to boost your online visibility.",
    service_5_title: "Advanced Marketing",
    service_5_desc: "Data-driven marketing strategies and high-performance paid ad campaigns for maximum ROI.",
    service_6_title: "Restaurant Tech Solutions",
    service_6_desc: "Modern QR code menus with an integrated ordering system to streamline your restaurant's service.",
    analyzer_service_photo: "Photography",
    analyzer_service_video_prod: "Video Production",
    analyzer_service_video_edit: "Video Editing",
    analyzer_service_sm_design: "Social Media Design",
    analyzer_service_paid_ads: "Paid Advertising",
    analyzer_service_paid_ads_fb: "Facebook",
    analyzer_service_paid_ads_fb_ig: "Facebook & Instagram",
    analyzer_service_paid_ads_fb_ig_tk: "Facebook, Instagram & TikTok",
    analyzer_service_gmaps: "Google Maps Optimization",
    analyzer_service_sm_manage: "Social Media Management",
    analyzer_sm_platforms_label: "Platforms to Manage",
    analyzer_sm_frequency_label: "Update Frequency",
    portfolio_title: "Our Work",
    portfolio_cta_title: "Explore Our Full Portfolio",
    portfolio_cta_subtitle: "See all our latest projects, client success stories, and behind-the-scenes content on our official Facebook page.",
    portfolio_cta_btn: "View on Facebook",
    testimonials_title: "What Our Clients Say",
    add_testimonial_btn: "Add Your Testimonial",
    contact_title: "Let's Work Together",
    contact_subtitle: "Send your request quickly via WhatsApp",
    contact_form_name: "Your Name",
    contact_form_business: "Business Activity",
    contact_form_phone: "Phone Number",
    contact_form_phone_placeholder: "Your number",
    contact_services_title: "Which services are you interested in?",
    contact_challenges_title: "What challenges is your business facing?",
    challenges: {
        "prefer_competitors": "Customers prefer competitors",
        "cant_convince": "Can't convince prospects I'm better",
        "low_sales": "Sharp decline in sales",
        "expansion_help": "Want to expand but don't know how",
        "weak_social": "Weak social media presence",
        "high_costs": "High marketing costs with no results",
        "few_new_clients": "Few new customers, rely on old ones",
        "weak_brand": "Weak visual identity, brand isn't distinct",
        "wrong_audience": "Difficulty reaching the right target audience",
        "bad_reviews": "Losing trust due to negative reviews",
        "ad_management": "Trouble managing ad campaigns",
    },
    contact_form_other_problem: "Other problem or more details...",
    contact_form_whatsapp_submit: "Send via WhatsApp",
    contact_country_title: "Which country are you from?",
    select_country_placeholder: "Select your country...",
    country_egypt: "Egypt",
    country_iraq: "Iraq",
    country_other: "Other",
    location_note: "Please choose your location carefully so we can provide you with the best service.",
    country_error: "We're sorry, our on-ground services are currently only available in Egypt and Iraq. Online services are available worldwide.",
    modal_title: "Choose Your Path",
    modal_services: "Explore Services",
    modal_portfolio: "See Our Work",
    modal_contact: "Contact Us",
    footer_copyright: "© 2025 Golden Studio – All Rights Reserved.",
    footer_privacy_policy: "Privacy Policy",
    privacy_title: "Privacy Policy",
    privacy_last_updated_label: "Last updated:",
    privacy_last_updated_date: "July 29, 2024",
    privacy_intro: "Golden Studio (\"us\", \"we\", or \"our\") operates the website (the \"Service\"). This page informs you of our policies regarding the collection, use, and disclosure of personal data when you use our Service and the choices you have associated with that data. We use your data to provide and improve the Service. By using the Service, you agree to the collection and use of information in accordance with this policy.",
    privacy_collection_title: "Information Collection And Use",
    privacy_collection_text: "We collect several different types of information for various purposes to provide and improve our Service to you.",
    privacy_types_title: "Types of Data Collected",
    privacy_personal_data_title: "Personal Data",
    privacy_personal_data_text: "While using our Service, we may ask you to provide us with certain personally identifiable information that can be used to contact or identify you (\"Personal Data\"). Personally identifiable information may include, but is not to:",
    privacy_personal_data_list: `<li>Email address</li><li>First name and last name</li><li>Phone number</li><li>Address, State, Province, ZIP/Postal code, City</li><li>Cookies and Usage Data</li>`,
    privacy_usage_data_title: "Usage Data",
    privacy_usage_data_text: "We may also collect information how the Service is accessed and used (\"Usage Data\"). This Usage Data may include information such as your computer's Internet Protocol address (e.g. IP address), browser type, browser version, the pages of our Service that you visit, the time and date of your visit, the time spent on those pages, unique device identifiers and other diagnostic data.",
    privacy_use_title: "Use of Data",
    privacy_use_text: "Golden Studio uses the collected data for various purposes:",
    privacy_use_list: `<li>To provide and maintain the Service</li><li>To notify you about changes to our Service</li><li>To allow you to participate in interactive features of our Service when you choose to do so</li><li>To provide customer care and support</li><li>To provide analysis or valuable information so that we can improve the Service</li><li>To monitor the usage of the Service</li><li>To detect, prevent and address technical issues</li>`,
    privacy_changes_title: "Changes To This Privacy Policy",
    privacy_changes_text: "We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page. You are advised to review this Privacy Policy periodically for any changes. Changes to this Privacy Policy are effective when they are posted on this page.",
    privacy_contact_title: "Contact Us",
    privacy_contact_text: "If you have any questions about this Privacy Policy, please contact us:",
    privacy_contact_list: `<li>By email: salman01099525798@gmail.com</li><li>By phone number: +201099525798</li>`,
    analyzer_select_governorate_placeholder: "Select a governorate...",
    analyzer_select_city_placeholder: "Select a city...",
    contact_form_error: "Please fill in all required fields.",
  },
  ar: {
    meta_title: "الاستوديو الذهبي - دعاية وإعلان",
    meta_description: "الاستوديو الذهبي: وكالة دعاية وإعلان متخصصة في التسويق الرقمي، إنتاج الفيديو، التصوير الفوتوغرافي، الهوية البصرية، والتصميم.",
    nav_logo: "جولدن ستوديو",
    nav_home: "الرئيسية",
    nav_services: "خدماتنا",
    nav_portfolio: "أعمالنا",
    nav_contact: "تواصل معنا",
    hero_title: "جولدن ستوديو للتسويق والإعلان",
    hero_subtitle: "نبتكر حلولاً إعلانية فريدة لتنمية أعمالك.",
    hero_cta: "ابدأ الآن",
    about_title: "من نحن",
    about_text: "نحن فريق شغوف من المبدعين والاستراتيجيين والمبتكرين، نكرس جهودنا للارتقاء بالعلامات التجارية. مهمتنا هي دمج الرؤية الفنية مع الخبرة التسويقية لتقديم نتائج مؤثرة وقصص ملهمة.",
    expertise_title: "خبراتنا",
    expertise_subtitle: "من المفاهيم الإبداعية إلى التنفيذ المتقن، شاهد ما نفعله وكيف ساعدنا الآخرين على النجاح.",
    services_title: "خدماتنا",
    services_tab_creative: "الإبداع والهوية",
    services_tab_marketing: "التسويق الرقمي",
    services_tab_tech: "حلول متخصصة",
    service_1_title: "الإنتاج والمحتوى",
    service_1_desc: "إنتاج فيديو وصور احترافي، من الفكرة إلى المونتاج النهائي، ليعكس جوهر علامتك التجارية.",
    service_2_title: "العلامة التجارية والهوية",
    service_2_desc: "تصميم شعارات لا تُنسى وهوية بصرية متكاملة تجعل علامتك التجارية تتميز عن المنافسين.",
    service_3_title: "التصميم المرئي والجرافيك",
    service_3_desc: "تصاميم جذابة للسوشيال ميديا ومرئيات إبداعية تلفت الانتباه وتزيد من تفاعل الجمهور.",
    service_4_title: "الحاضر الرقمي",
    service_4_desc: "إدارة شاملة لوسائل التواصل الاجتماعي وتحسين خرائط جوجل لتعزيز ظهورك على الإنترنت.",
    service_5_title: "التسويق المتقدم",
    service_5_desc: "استراتيجيات تسويق قائمة على البيانات وحملات إعلانية مدفوعة عالية الأداء لتحقيق أقصى عائد.",
    service_6_title: "حلول تقنية للمطاعم",
    service_6_desc: "قوائم طعام QR Code حديثة مع نظام طلب متكامل لتسهيل خدمة مطعمك وزيادة الكفاءة.",
    analyzer_service_photo: "تصوير فوتوغرافي",
    analyzer_service_video_prod: "إنتاج فيديو",
    analyzer_service_video_edit: "مونتاج فيديو",
    analyzer_service_sm_design: "تصميمات سوشيال ميديا",
    analyzer_service_paid_ads: "إعلانات ممولة",
    analyzer_service_paid_ads_fb: "فيسبوك",
    analyzer_service_paid_ads_fb_ig: "فيسبوك وانستغرام",
    analyzer_service_paid_ads_fb_ig_tk: "فيسبوك، انستغرام وتيك توك",
    analyzer_service_gmaps: "تحسين خرائط جوجل",
    analyzer_service_sm_manage: "إدارة صفحات السوشيال ميديا",
    analyzer_sm_platforms_label: "المنصات المراد إدارتها",
    analyzer_sm_frequency_label: "معدل التحديث",
    portfolio_title: "أعمالنا",
    portfolio_cta_title: "اكتشف معرض أعمالنا الكامل",
    portfolio_cta_subtitle: "شاهد أحدث مشاريعنا وقصص نجاح عملائنا ومحتوى ما وراء الكواليس على صفحتنا الرسمية على فيسبوك.",
    portfolio_cta_btn: "شاهد على فيسبوك",
    testimonials_title: "ماذا يقول عملاؤنا",
    add_testimonial_btn: "أضف تقييمك",
    contact_title: "دعنا نعمل معًا",
    contact_subtitle: "أرسل طلبك بسرعة عبر واتساب",
    contact_form_name: "اسمك",
    contact_form_business: "نشاطك التجاري",
    contact_form_phone: "رقم الهاتف",
    contact_form_phone_placeholder: "رقمك",
    contact_services_title: "ما هي الخدمات التي تهتم بها؟",
    contact_challenges_title: "ما هي التحديات التي تواجه عملك؟",
    challenges: {
      "prefer_competitors": "العملاء يفضلون المنافسين",
      "cant_convince": "لا أستطيع إقناع العملاء بأنني الأفضل",
      "low_sales": "انخفاض حاد في المبيعات",
      "expansion_help": "أرغب في التوسع ولكن لا أعرف كيف",
      "weak_social": "حضور ضعيف على وسائل التواصل الاجتماعي",
      "high_costs": "تكاليف تسويق عالية دون نتائج",
      "few_new_clients": "عملاء جدد قليلون، والاعتماد على القدامى",
      "weak_brand": "هوية بصرية ضعيفة، والعلامة التجارية غير مميزة",
      "wrong_audience": "صعوبة الوصول إلى الجمهور المستهدف الصحيح",
      "bad_reviews": "فقدان الثقة بسبب التقييمات السلبية",
      "ad_management": "صعوبة في إدارة الحملات الإعلانية",
    },
    contact_form_other_problem: "مشكلة أخرى أو تفاصيل إضافية...",
    contact_form_whatsapp_submit: "إرسال عبر واتساب",
    contact_country_title: "من أي بلد أنت؟",
    select_country_placeholder: "اختر بلدك...",
    country_egypt: "مصر",
    country_iraq: "العراق",
    country_other: "أخرى",
    location_note: "يرجى اختيار موقعك بعناية لنتمكن من تقديم أفضل خدمة لك.",
    country_error: "عذرًا، خدماتنا الميدانية متاحة حاليًا في مصر والعراق فقط. الخدمات عبر الإنترنت متاحة في جميع أنحاء العالم.",
    modal_title: "اختر وجهتك",
    modal_services: "اكتشف خدماتنا",
    modal_portfolio: "شاهد أعمالنا",
    modal_contact: "تواصل معنا",
    footer_copyright: "© 2025 جولدن ستوديو – جميع الحقوق محفوظة.",
    footer_privacy_policy: "سياسة الخصوصية",
    privacy_title: "سياسة الخصوصية",
    privacy_last_updated_label: "آخر تحديث:",
    privacy_last_updated_date: "29 يوليو 2024",
    privacy_intro: "يقوم جولدن ستوديو (\"نحن\"، \"لنا\") بتشغيل الموقع الإلكتروني (\"الخدمة\"). هذه الصفحة تُعلمك بسياساتنا المتعلقة بجمع واستخدام والكشف عن البيانات الشخصية عند استخدامك لخدمتنا والخيارات المتاحة لك بخصوص هذه البيانات. نحن نستخدم بياناتك لتوفير الخدمة وتحسينها. باستخدامك للخدمة، فإنك توافق على جمع واستخدام المعلومات وفقًا لهذه السياسة.",
    privacy_collection_title: "جمع المعلومات واستخدامها",
    privacy_collection_text: "نقوم بجمع عدة أنواع مختلفة من المعلومات لأغراض متنوعة لتوفير وتحسين خدمتنا لك.",
    privacy_types_title: "أنواع البيانات المجمعة",
    privacy_personal_data_title: "البيانات الشخصية",
    privacy_personal_data_text: "أثناء استخدام خدمتنا، قد نطلب منك تزويدنا ببعض المعلومات الشخصية التي يمكن استخدامها للاتصال بك أو تحديد هويتك (\"البيانات الشخصية\"). قد تشمل هذه المعلومات، على سبيل المثال لا الحصر:",
    privacy_personal_data_list: `<li>عنوان البريد الإلكتروني</li><li>الاسم الأول واسم العائلة</li><li>رقم الهاتف</li><li>العنوان، الولاية، المقاطعة، الرمز البريدي، المدينة</li><li>ملفات تعريف الارتباط وبيانات الاستخدام</li>`,
    privacy_usage_data_title: "بيانات الاستخدام",
    privacy_usage_data_text: "قد نقوم أيضًا بجمع معلومات حول كيفية الوصول إلى الخدمة واستخدامها (\"بيانات الاستخدام\"). قد تتضمن بيانات الاستخدام هذه معلومات مثل عنوان بروتوكول الإنترنت لجهاز الكمبيوتر الخاص بك (مثل عنوان IP)، ونوع المتصفح، وإصدار المتصفح، وصفحات خدمتنا التي تزورها، ووقت وتاريخ زيارتك، والوقت الذي تقضيه على تلك الصفحات، ومعرفات الأجهزة الفريدة وبيانات التشخيص الأخرى.",
    privacy_use_title: "استخدام البيانات",
    privacy_use_text: "يستخدم جولدن ستوديو البيانات المجمعة لأغراض مختلفة:",
    privacy_use_list: `<li>لتوفير الخدمة وصيانتها</li><li>لإعلامك بالتغييرات التي تطرأ على خدمتنا</li><li>للسماح لك بالمشاركة في الميزات التفاعلية لخدمتنا عندما تختار القيام بذلك</li><li>لتقديم خدمة ودعم العملاء</li><li>لتقديم تحليلات أو معلومات قيمة حتى نتمكن من تحسين الخدمة</li><li>لمراقبة استخدام الخدمة</li><li>لاكتشاف ومنع ومعالجة المشكلات الفنية</li>`,
    privacy_changes_title: "التغييرات على سياسة الخصوصية هذه",
    privacy_changes_text: "قد نقوم بتحديث سياسة الخصوصية الخاصة بنا من وقت لآخر. سنقوم بإعلامك بأي تغييرات عن طريق نشر سياسة الخصوصية الجديدة على هذه الصفحة. يُنصح بمراجعة سياسة الخصوصية هذه بشكل دوري لأي تغييرات. تكون التغييرات على سياسة الخصوصية هذه فعالة عند نشرها على هذه الصفحة.",
    privacy_contact_title: "اتصل بنا",
    privacy_contact_text: "إذا كان لديك أي أسئلة حول سياسة الخصوصية هذه، يرجى الاتصال بنا:",
    privacy_contact_list: `<li>عبر البريد الإلكتروني: salman01099525798@gmail.com</li><li>عبر رقم الهاتف: 201099525798+</li>`,
    analyzer_select_governorate_placeholder: "اختر محافظة...",
    analyzer_select_city_placeholder: "اختر مدينة...",
    contact_form_error: "يرجى ملء جميع الحقول المطلوبة.",
  }
};

let currentLang = 'en';
let egyptLocations, iraqLocations, locationCoords;

// --- DOM Elements ---
const getElem = (id) => document.getElementById(id);
const querySel = (selector) => document.querySelector(selector);
const querySelAll = (selector) => document.querySelectorAll(selector);

// --- Initialization ---
document.addEventListener('DOMContentLoaded', async () => {
    // Set initial language based on browser or saved preference
    const savedLang = localStorage.getItem('lang');
    if (savedLang) {
        currentLang = savedLang;
    } else {
        currentLang = navigator.language.startsWith('ar') ? 'ar' : 'en';
    }
    await setLanguage(currentLang);

    initializeEventListeners();
    initializeObserver('.content-section, .service-card');
    initializeTestimonials();
    loadLocationData();
    populateChallenges();
    
    if (window.innerWidth >= 768) {
        const cursorGlow = getElem('cursor-glow');
        if(cursorGlow) {
            cursorGlow.style.display = 'block';
            document.addEventListener('mousemove', (e) => {
                cursorGlow.style.left = `${e.clientX}px`;
                cursorGlow.style.top = `${e.clientY}px`;
            });
        }
    }
});

// --- Internationalization (i18n) ---
async function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('lang', lang);
    const isRTL = lang === 'ar';
    
    document.documentElement.lang = lang;
    document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
    
    getElem('lang-toggle').textContent = isRTL ? 'EN' : 'AR';
    
    // Update all text content
    querySelAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        const translation = getTranslation(key);
        if (translation) {
            // Handle different element types
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                if (el.placeholder !== translation) el.placeholder = translation;
            } else if (el.tagName === 'META') {
                if (el.content !== translation) el.content = translation;
            } else {
                 if (el.innerHTML !== translation) el.innerHTML = translation;
            }
        }
    });

    // Specific updates for dynamic content
    updatePlaceholders();
    populateCountryCodes();
    populateChallenges(); // Repopulate to get correct language
}

function getTranslation(key, lang = currentLang) {
    // Nested key access, e.g., "challenges.low_sales"
    return key.split('.').reduce((obj, k) => (obj && obj[k] !== 'undefined') ? obj[k] : `{{${key}}}`, translations[lang]);
}

function updatePlaceholders() {
    const countrySelect = getElem('country-select');
    if (countrySelect && countrySelect.options[0] && countrySelect.options[0].value === "") {
        countrySelect.options[0].textContent = getTranslation('select_country_placeholder');
    }
}

// --- Event Listeners Setup ---
function initializeEventListeners() {
    getElem('lang-toggle').addEventListener('click', () => setLanguage(currentLang === 'en' ? 'ar' : 'en'));

    // Navigation
    const burgerMenu = getElem('burger-menu');
    const navLinksContainer = getElem('nav-links-container');
    burgerMenu.addEventListener('click', () => {
        burgerMenu.classList.toggle('active');
        navLinksContainer.classList.toggle('active');
        document.body.classList.toggle('nav-open');
    });

    querySelAll('.nav-link, .modal-link').forEach(link => {
        link.addEventListener('click', (event) => {
            const target = event.currentTarget;
            const href = target.getAttribute('href');

            if (href && href.startsWith('#')) {
                event.preventDefault();
                
                const targetId = href.substring(1);
                const targetElement = document.getElementById(targetId);

                // Close mobile nav if open
                if (burgerMenu.classList.contains('active')) {
                    burgerMenu.classList.remove('active');
                    navLinksContainer.classList.remove('active');
                    document.body.classList.remove('nav-open');
                }
                
                // If it's a modal link, close the modal it's in
                if (target.classList.contains('modal-link')) {
                    const modal = target.closest('.modal-overlay');
                    if (modal) {
                        hideModal(modal.id);
                    }
                }

                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            }
        });
    });

    // Scroll & FABs
    const scrollToTopBtn = getElem('scroll-to-top');
    window.addEventListener('scroll', () => {
        const isVisible = window.scrollY > 300;
        scrollToTopBtn.classList.toggle('visible', isVisible);
    });
    scrollToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

    // Modals
    setupModalClose('privacy-policy-modal');
    getElem('privacy-policy-link').addEventListener('click', () => showModal('privacy-policy-modal'));

    // Contact Form
    getElem('country-select').addEventListener('change', handleCountryChange);
    getElem('governorate-select').addEventListener('change', handleGovernorateChange);
    getElem('whatsapp-form').addEventListener('submit', handleWhatsAppSubmit);
    getElem('service-selector-grid').addEventListener('click', handleServiceSelection);

    // Service Tabs
    const tabsContainer = querySel('.services-tabs');
    if (tabsContainer) {
        tabsContainer.addEventListener('click', (e) => {
            const targetButton = e.target.closest('.tab-btn');
            if (targetButton) {
                // Deactivate all
                querySelAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                querySelAll('.services-panel').forEach(panel => panel.classList.remove('active'));

                // Activate selected
                targetButton.classList.add('active');
                const tabId = targetButton.dataset.tab;
                const activePanel = getElem(`tab-${tabId}`);
                if (activePanel) {
                    activePanel.classList.add('active');
                }
            }
        });
    }
}


// --- UI & UX Enhancements ---

// Intersection Observer for animations
function initializeObserver(selector) {
    const observer = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                obs.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });
    querySelAll(selector).forEach(el => observer.observe(el));
}

// --- Testimonials ---
function initializeTestimonials() {
    const testimonials = [
        {
            rating: 5,
            text_en: "Golden Studio transformed our online presence. Their creativity and professionalism are unmatched. Highly recommended!",
            text_ar: "جولدن ستوديو غيّر وجودنا على الإنترنت. إبداعهم واحترافيتهم لا مثيل لهما. نوصي بهم بشدة!",
            author_en: "Ahmed Mansour, CEO of Tech Solutions",
            author_ar: "أحمد منصور، الرئيس التنفيذي لشركة حلول التقنية"
        },
        {
            rating: 5,
            text_en: "The video production was outstanding, far exceeding our expectations. The team is talented and delivered on time.",
            text_ar: "إنتاج الفيديو كان مذهلاً، وتجاوز توقعاتنا بكثير. الفريق موهوب وقد سلموا العمل في الوقت المحدد.",
            author_en: "Fatima Al-Ali, Marketing Director",
            author_ar: "فاطمة العلي، مديرة التسويق"
        },
        {
            rating: 5,
            text_en: "From branding to social media management, Golden Studio has been a key partner in our success story.",
            text_ar: "من تصميم الهوية التجارية إلى إدارة وسائل التواصل الاجتماعي، كان جولدن ستوديو شريكًا رئيسيًا في قصة نجاحنا.",
            author_en: "Youssef El-Masry, Restaurant Owner",
            author_ar: "يوسف المصري، صاحب مطعم"
        }
    ];

    const slider = getElem('testimonial-slider');
    slider.innerHTML = testimonials.map(t => `
        <div class="testimonial-card">
            <div class="rating">${'★'.repeat(t.rating)}${'☆'.repeat(5 - t.rating)}</div>
            <p class="testimonial-text">${currentLang === 'ar' ? t.text_ar : t.text_en}</p>
            <p class="testimonial-author">${currentLang === 'ar' ? t.author_ar : t.author_en}</p>
        </div>
    `).join('');

    let currentIndex = 0;
    const totalSlides = testimonials.length;
    const updateSlider = () => {
        slider.style.transform = `translateX(-${currentIndex * 100}%)`;
    };

    getElem('testimonial-next').addEventListener('click', () => {
        currentIndex = (currentIndex + 1) % totalSlides;
        updateSlider();
    });
    getElem('testimonial-prev').addEventListener('click', () => {
        currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
        updateSlider();
    });
}

// --- Modal Management ---
function showModal(modalId) {
    const modal = getElem(modalId);
    if (modal) {
        modal.hidden = false;
        document.body.style.overflow = 'hidden';
    }
}
function hideModal(modalId) {
    const modal = getElem(modalId);
    if (modal) {
        modal.hidden = true;
        // Only restore scroll if no other modals are open
        if (!querySel('.modal-overlay:not([hidden])')) {
            document.body.style.overflow = 'auto';
        }
    }
}
function setupModalClose(modalId) {
    const modal = getElem(modalId);
    if (modal) {
        // Close on 'X' button click
        modal.querySelector('.modal-close').addEventListener('click', () => hideModal(modalId));
        // Close on overlay click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                hideModal(modalId);
            }
        });
    }
}


function handleServiceSelection(event) {
    const card = event.target.closest('.service-selector-card');
    if (!card) return;
    card.classList.toggle('selected');
    
    const isComplexHeader = event.target.closest('.card-header');
    if(card.dataset.serviceGroup && isComplexHeader){
         if (card.classList.contains('selected') && !card.querySelector('input[type="radio"]:checked')) {
            card.querySelector('input[type="radio"]').checked = true;
        }
    }
}


// --- Contact Form & Location ---
async function loadLocationData() {
    try {
        const [egyptRes, iraqRes, coordsRes] = await Promise.all([
            fetch('./egypt-locations.json'),
            fetch('./iraq-locations.json'),
            fetch('./location-coords.json')
        ]);
        egyptLocations = await egyptRes.json();
        iraqLocations = await iraqRes.json();
        locationCoords = await coordsRes.json();
        
        populateCountryCodes();
    } catch (error) {
        console.error("Failed to load location data:", error);
    }
}

function handleCountryChange() {
    const country = getElem('country-select').value;
    const governoratesContainer = getElem('governorates-container');
    const countryError = getElem('country-error-message');
    const governorateSelect = getElem('governorate-select');
    const citySelect = getElem('city-select');

    governorateSelect.innerHTML = '';
    citySelect.innerHTML = '';
    citySelect.disabled = true;

    if (country === 'egypt' || country === 'iraq') {
        governoratesContainer.hidden = false;
        countryError.hidden = true;
        const locations = country === 'egypt' ? egyptLocations : iraqLocations;
        populateSelect(governorateSelect, Object.keys(locations), getTranslation('analyzer_select_governorate_placeholder'));
    } else if (country === 'other') {
        governoratesContainer.hidden = true;
        countryError.hidden = false;
    } else {
        governoratesContainer.hidden = true;
        countryError.hidden = true;
    }
}

function handleGovernorateChange() {
    const country = getElem('country-select').value;
    const governorate = getElem('governorate-select').value;
    const citySelect = getElem('city-select');
    const locations = country === 'egypt' ? egyptLocations : iraqLocations;

    if (governorate && locations[governorate]) {
        populateSelect(citySelect, locations[governorate], getTranslation('analyzer_select_city_placeholder'));
        citySelect.disabled = false;
    } else {
        citySelect.innerHTML = '';
        citySelect.disabled = true;
    }
}

function populateSelect(selectElement, options, placeholder) {
    selectElement.innerHTML = `<option value="" disabled selected>${placeholder}</option>`;
    options.forEach(option => {
        const opt = document.createElement('option');
        opt.value = option;
        opt.textContent = option;
        selectElement.appendChild(opt);
    });
}

function populateCountryCodes() {
    const codes = {
        "Egypt": "+20",
        "Iraq": "+964",
        "Saudi Arabia": "+966",
        "UAE": "+971",
        "Qatar": "+974",
        "Kuwait": "+965",
        "Bahrain": "+973",
        "Oman": "+968",
        "Jordan": "+962",
        "Lebanon": "+961"
    };
    
    const select = getElem('phone-code-select');
    if (!select) return;
    
    select.innerHTML = '';
    
    if(egyptLocations) select.add(new Option('🇪🇬 Egypt (+20)', '+20'));
    if(iraqLocations) select.add(new Option('🇮🇶 Iraq (+964)', '+964'));
    
    for (const country in codes) {
        if (country !== "Egypt" && country !== "Iraq") {
            const flag = getFlagEmoji(country.replace(/\s/g, ''));
            select.add(new Option(`${flag} ${country} (${codes[country]})`, codes[country]));
        }
    }
}

function getFlagEmoji(country) {
    const flags = {
        "SaudiArabia": "🇸🇦", "UAE": "🇦🇪", "Qatar": "🇶🇦", 
        "Kuwait": "🇰🇼", "Bahrain": "🇧🇭", "Oman": "🇴🇲", 
        "Jordan": "🇯🇴", "Lebanon": "🇱🇧"
    };
    return flags[country] || '🏳️';
}

function populateChallenges() {
    const grid = getElem('challenges-grid');
    const challenges = getTranslation('challenges');
    if (grid && typeof challenges === 'object') {
        grid.innerHTML = Object.keys(challenges).map(key => 
            `<button type="button" class="challenge-tag" data-challenge-key="${key}">${challenges[key]}</button>`
        ).join('');

        grid.addEventListener('click', (e) => {
            const target = e.target;
            if (target.classList.contains('challenge-tag')) {
                target.classList.toggle('selected');
            }
        });
    }
}

function handleWhatsAppSubmit(event) {
    event.preventDefault();

    const name = getElem('wa-name').value.trim();
    const business = getElem('wa-business').value.trim();
    const phoneCode = getElem('phone-code-select').value;
    const phone = getElem('wa-phone').value.trim();
    
    if (!name || !business || !phone) {
        alert(getTranslation('contact_form_error'));
        return;
    }
    
    // Collect selected services
    const selectedServicesCards = Array.from(querySelAll('.service-selector-card.selected[data-service]'))
        .map(card => card.dataset.service);
    
    const complexCard = querySel('.service-selector-card.selected[data-service-group]');
    if (complexCard) {
        const platform = querySel('input[name="sm_platform"]:checked')?.value || "Facebook & Instagram";
        const duration = querySel('input[name="sm_duration"]:checked')?.value || "12 hours";
        const smService = `Social Media Management (${platform}, updates every ${duration})`;
        selectedServicesCards.push(smService);
    }
    
    let servicesText = "";
    if (selectedServicesCards.length > 0) {
        const servicesList = selectedServicesCards.map(service => `- ${service}`).join('\n');
        servicesText = `*${getTranslation('contact_services_title')}*\n${servicesList}\n\n`;
    }

    const selectedChallenges = Array.from(querySelAll('.challenge-tag.selected'))
        .map(tag => `- ${tag.textContent}`).join('\n');
    let challengesText = "";
    if(selectedChallenges) {
        challengesText = `*${getTranslation('contact_challenges_title')}*\n${selectedChallenges}\n\n`;
    }
    
    const otherProblem = getElem('wa-other-problem').value.trim();
    let otherProblemText = otherProblem ? `*${getTranslation('contact_form_other_problem')}*\n${otherProblem}\n\n` : "";

    const country = getElem('country-select').value;
    let locationText = "";
    if (country === 'egypt' || country === 'iraq') {
        const gov = getElem('governorate-select').value;
        const city = getElem('city-select').value;
        locationText = `*Location:* ${city}, ${gov}, ${country.charAt(0).toUpperCase() + country.slice(1)}\n`;
    } else {
        locationText = `*Country:* ${country}\n`;
    }

    let message = `
*New Client Request from Website*

*Name:* ${name}
*Business Activity:* ${business}
*Phone:* ${phoneCode}${phone}
${locationText}
${servicesText}${challengesText}${otherProblemText}
    `.trim().replace(/\n\s*\n/g, '\n\n');

    const whatsappURL = `https://wa.me/201099525798?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL, '_blank');
}


// --- Helpers ---
function setButtonLoading(button, isLoading, loadingText) {
    const btnContent = button.querySelector('.btn-content');
    const spinner = button.querySelector('.spinner');
    const btnText = btnContent.querySelector('span');
    const originalText = button.dataset.originalText || (btnText ? btnText.textContent : '');
    if (!button.dataset.originalText) {
       button.dataset.originalText = originalText;
    }


    if (isLoading) {
        button.classList.add('loading');
        button.disabled = true;
        if(btnText) btnText.textContent = loadingText;
        if(spinner) spinner.hidden = false;
    } else {
        button.classList.remove('loading');
        button.disabled = false;
        if(btnText) btnText.textContent = button.dataset.originalText;
        if(spinner) spinner.hidden = true;
    }
}
